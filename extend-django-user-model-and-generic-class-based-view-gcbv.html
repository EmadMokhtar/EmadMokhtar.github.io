<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" type="text/css" href="http://www.emadmokhtar.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://www.emadmokhtar.com/theme/stylesheet/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://www.emadmokhtar.com/theme/stylesheet/font-awesome.min.css">


  <link href="http://www.emadmokhtar.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Emad Mokhtar's Framework Atom">

  <link href="http://www.emadmokhtar.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Emad Mokhtar's Framework RSS">

  <link rel="shortcut icon" href="http://www.emadmokhtar.com/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="http://www.emadmokhtar.com/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

<meta name="author" content="Emad Mokhtar" />
<meta name="description" content="When I started to learn Django, I used to use the function based view aka FBV and in my current project I decided to learn class based view CBV, I watched one DjangoCon videos by Andrew Pinkham to make this easier on me, and if you tried or planning to learn CBV, you will be confused about the class based views and the generic class based views inside Django, it’s some many of them, please watch the video to get your head around it. OK, now I’ve done my homework and it’s time to use CBV, believe me it’s easy and you will find the number of code lines inside our views will be decreased specially if you use GCBV. User Model and GCBV What is the relation between GCBV and User Model? Great question, while I’m working with one of my models fro example her the Teacher model, and teacher will has a user credentials in order to user the app. The easiest and the straightforward way is to make one-to-one relation with django.contrib.auth.models.User please read the quote from Django documentation: There are two ways to extend the default User …" />
<meta name="keywords" content="Django, Python">
<meta property="og:site_name" content="Emad Mokhtar's Framework"/>
<meta property="og:title" content="Extend Django User Model and Generic Class Based View "GCBV""/>
<meta property="og:description" content="When I started to learn Django, I used to use the function based view aka FBV and in my current project I decided to learn class based view CBV, I watched one DjangoCon videos by Andrew Pinkham to make this easier on me, and if you tried or planning to learn CBV, you will be confused about the class based views and the generic class based views inside Django, it’s some many of them, please watch the video to get your head around it. OK, now I’ve done my homework and it’s time to use CBV, believe me it’s easy and you will find the number of code lines inside our views will be decreased specially if you use GCBV. User Model and GCBV What is the relation between GCBV and User Model? Great question, while I’m working with one of my models fro example her the Teacher model, and teacher will has a user credentials in order to user the app. The easiest and the straightforward way is to make one-to-one relation with django.contrib.auth.models.User please read the quote from Django documentation: There are two ways to extend the default User …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://www.emadmokhtar.com/extend-django-user-model-and-generic-class-based-view-gcbv.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2015-12-18 12:00:00+03:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://www.emadmokhtar.com/author/emad-mokhtar.html">
<meta property="article:section" content="Django"/>
<meta property="article:tag" content="Django"/>
<meta property="article:tag" content="Python"/>
<meta property="og:image" content="http://www.emadmokhtar.com/images/profile.jpg">
  <title>Emad Mokhtar's Framework &ndash; Extend Django User Model and Generic Class Based View "GCBV"</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://www.emadmokhtar.com">
        <img src="http://www.emadmokhtar.com/images/profile.jpg" alt="" title="">
      </a>
      <h1><a href="http://www.emadmokhtar.com"></a></h1>
      <p>Geek developer who's in search of code perfection.</p>
      <nav>
        <ul class="list">
           <li><a href="http://www.emadmokhtar.com">Blog</a></li>
          <li><a href="http://www.emadmokhtar.com/pages/podcasts.html#podcasts">Podcasts</a></li>
          <li><a href="http://www.emadmokhtar.com/pages/projects.html#projects">Projects</a></li>
          <li><a href="https://emadmokhtar.github.io/resume" target="_blank">Resume</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-envelope-o" href="mailto:emad@emadmokhtar.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-github" href="https://www.github.com/EmadMokhtar" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/emadmokhtar/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-stack-overflow" href="http://stackoverflow.com/users/373051/emad-mokhtar" target="_blank"><i class="fa fa-stack-overflow"></i></a></li>
        <li><a class="sc-facebook" href="https://www.facebook.com/emadmokhtarframework/" target="_blank"><i class="fa fa-facebook"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/emadmokhtar" target="_blank"><i class="fa fa-twitter"></i></a></li>
    </ul>
  </div>
</aside>
<main>
  <nav>
    <a href="http://www.emadmokhtar.com">Home</a>
    <a href="https://emadmokhtar.github.io/resume">Resume</a>
    <a href="http://www.emadmokhtar.com/feeds/all.atom.xml">Atom</a>
    <a href="http://www.emadmokhtar.com/feeds/all.rss.xml">RSS</a>
  </nav>

<article>
  <header>
    <h1 id="extend-django-user-model-and-generic-class-based-view-gcbv">Extend Django User Model and Generic Class Based View "GCBV"</h1>
    <p>Posted on Fri 18 December 2015 in <a href="http://www.emadmokhtar.com/category/django.html">Django</a> <b>Read in 6 min.</b></p>
  </header>
  <div>
    <p><img alt="1450356512_full.png" src="http://www.emadmokhtar.com/images/1450356512_full.png"> When I started to learn Django, I used to use the function based view aka FBV and in my current project I decided to learn class based view CBV, I watched one <a href="https://www.youtube.com/watch?v=BJiOERA49ZQ">DjangoCon videos by Andrew Pinkham</a> to make this easier on me, and if you tried or planning to learn CBV, you will be confused about the class based views and the generic class based views inside Django, it’s some many of them, please watch the video to get your head around it. OK, now I’ve done my homework and it’s time to use CBV, believe me it’s easy and you will find the number of code lines inside our views will be decreased specially if you use GCBV. User Model and GCBV </p>
<h1>What is the relation between GCBV and User Model?</h1>
<p>Great question, while I’m working with one of my models fro example her the Teacher model, and teacher will has a user credentials in order to user the app. The easiest and the straightforward way is to make one-to-one relation with <a href="https://github.com/django/django/blob/53ccffdb8c8e47a4d4304df453d8c79a9be295ab/django/contrib/auth/models.py">django.contrib.auth.models.User</a> please read the quote from Django documentation: </p>
<blockquote>
<p>There are two ways to extend the default User model without substituting your own model. If the changes you need are purely behavioral, and don’t require any change to what is stored in the database, you can create a proxy model based on User. This allows for any of the features offered by proxy models including default ordering, custom managers, or custom model methods. If you wish to store information related to User, you can use a one-to-one relationship to a model containing the fields for additional information. This one-to-one model is often called a profile model, as it might store non-auth related information about a site user. </p>
</blockquote>
<p>So I decide to go with one-to-one relationship way. </p>
<h1>The Teacher Model</h1>
<div class="highlight"><pre><span></span><span class="n">FEMALE</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
<span class="n">MALE</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span> 
<span class="k">class</span> <span class="nc">Teacher</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span> 
    <span class="n">GENDER_CHOICES</span> <span class="o">=</span> <span class="p">(</span> 
        <span class="p">(</span><span class="n">MALE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Male&#39;</span><span class="p">)),</span> 
        <span class="p">(</span><span class="n">FEMALE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Female&#39;</span><span class="p">)),</span> 
        <span class="p">)</span> 
    <span class="n">gender</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">),</span> <span class="n">choices</span><span class="o">=</span><span class="n">GENDER_CHOICES</span><span class="p">)</span> 
    <span class="n">civil_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Civil ID&#39;</span><span class="p">))</span> 
    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Phone Number&#39;</span><span class="p">))</span> 
    <span class="n">job_title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">))</span> 
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;teacher_profile&#39;</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Enable teacher profile </span>
<span class="sd">    :return: </span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">True</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> 

    <span class="k">def</span> <span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Disable teacher profile </span>
<span class="sd">    :return: </span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">False</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> 

    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;teacher_details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,))</span>
</pre></div>


<h1>Issues</h1>
<p>The issue is I want to display all fields from Teacher and User form on one template page and handle the creation. so there are 2 issues: </p>
<ol>
<li>Display Teacher and User models fields’ on one template page using CreateView class.</li>
<li>Handle the under the hood creation process.
I posted a question over <a href="http://stackoverflow.com/questions/34117408/django-user-model-one-to-one-with-other-model-and-forms">Stack Overflow</a> regarding these issues. </li>
</ol>
<h1>Solutions</h1>
<h2>Thinking about a solution for the first issue</h2>
<p>After I studied the <em>CreateView</em> generic view class, it can take only one form using <em>form_class</em> attribute. I knew Django render context variables on the template, and <em>CreateView</em> will pass the <em>form_class</em> to the template to render it, so I thought about adding second form to the class and add it to the context before passing it to the template, thus I override <em>get_context_data()</em> method and add the second form to the context. </p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
    <span class="c1">#Get the context </span>
    <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TeacherCreation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
    <span class="c1">#Adding the second form </span>
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;user_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_form_class</span> 
    <span class="k">return</span> <span class="n">context</span> 
</pre></div>


<p>Now I’m passing one form for Teacher model and the second form is for User model, and in the template display both forms. </p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span> <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span> 
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel panel-default&quot;</span><span class="o">&gt;</span> 
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel-heading&quot;</span><span class="o">&gt;</span> 
            <span class="o">&lt;</span><span class="n">h3</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel-title&quot;</span><span class="o">&gt;</span> <span class="n">Teacher</span> <span class="n">Information</span> <span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span> 
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span> 
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span> 
            <span class="p">{{</span> <span class="n">user_form</span> <span class="p">}}</span> 
            <span class="p">{{</span> <span class="n">form</span> <span class="p">}}</span> 
            <span class="o">&lt;</span><span class="n">button</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn btn-primary&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Save</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span> 
</pre></div>


<p>The first issue solved. </p>
<h2>Thinking for a solution for the second issue</h2>
<p>Now I can display 2 forms on template using <em>CreateView</em> class, but what about posting or saving data/form. To do this I override <em>form_valid</em> method and done the work there. </p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span> 
    <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserCreationForm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">user_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> 
        <span class="n">user</span> <span class="o">=</span> <span class="n">user_form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> 
        <span class="n">teacher</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> 
        <span class="n">teacher</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span> 
        <span class="n">teacher</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> 
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_success_url</span><span class="p">())</span>
</pre></div>


<p>The second issue solved but what about the update, it's easy and almost the same as <em>CreateView</em>, so let's see How er can do it </p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
    <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TeacherUpdate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
    <span class="n">context</span><span class="p">[</span><span class="s1">&#39;user_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_form_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">context</span> 

<span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span> 
    <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserChangeForm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">user_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> 
        <span class="n">user_form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> 
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TeacherUpdate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>


<h1>Full Example</h1>
<div class="highlight"><pre><span></span><span class="c1">########################</span>
<span class="c1"># models.py</span>
<span class="c1">########################</span>
<span class="n">FEMALE</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
<span class="n">MALE</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>

<span class="k">class</span> <span class="nc">Teacher</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Halaqat teachers information</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">GENDER_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">MALE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Male&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">FEMALE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Female&#39;</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">gender</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">),</span>
                              <span class="n">choices</span><span class="o">=</span><span class="n">GENDER_CHOICES</span><span class="p">)</span>
    <span class="n">civil_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Civil ID&#39;</span><span class="p">))</span>
    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                                    <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Phone Number&#39;</span><span class="p">))</span>
    <span class="n">job_title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">))</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;teacher_profile&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable teacher profile</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable teacher profile</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;teacher_details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,))</span>

<span class="c1">########################</span>
<span class="c1"># views.py</span>
<span class="c1">########################</span>
<span class="k">class</span> <span class="nc">TeacherCreation</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates new teacher</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;back_office/teacher_form.html&#39;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">TeacherForm</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Teacher</span>
    <span class="n">second_form_class</span> <span class="o">=</span> <span class="n">UserCreationForm</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Teacher profile saved successfully&#39;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TeacherCreation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;user_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_form_class</span>

        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserCreationForm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">user_form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">teacher</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">teacher</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
            <span class="n">teacher</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_success_url</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">TeacherUpdate</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update teacher profile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Teacher</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;back_office/teacher_form.html&#39;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">TeacherForm</span>
    <span class="n">second_form_class</span> <span class="o">=</span> <span class="n">UserChangeForm</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Teacher profile saved successfully&#39;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TeacherUpdate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;user_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_form_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserChangeForm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user_form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TeacherUpdate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

<span class="c1">########################</span>
<span class="c1"># teacher_form.html</span>
<span class="c1">########################</span>
<span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s1">&#39;back_office/back_office_base.html&#39;</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">crispy_forms_tags</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">title</span> <span class="o">%</span><span class="p">}</span>
    <span class="n">New</span> <span class="n">Teacher</span> <span class="n">Form</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">container</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel panel-default&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel-heading&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">h3</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel-title&quot;</span><span class="o">&gt;</span><span class="n">Teacher</span> <span class="n">Information</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span>
                <span class="p">{{</span> <span class="n">user_form</span><span class="o">|</span><span class="n">crispy</span> <span class="p">}}</span>
                <span class="p">{{</span> <span class="n">form</span><span class="o">|</span><span class="n">crispy</span> <span class="p">}}</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn btn-primary&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;glyphicon glyphicon-floppy-disk&quot;</span> <span class="n">aria</span><span class="o">-</span><span class="n">hidden</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                            <span class="n">Save</span>
                <span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://www.emadmokhtar.com/tag/django.html">Django</a>
      <a href="http://www.emadmokhtar.com/tag/python.html">Python</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'emadmokhtarsframework';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

  <footer>
    <p>&copy; Emad Mokhtar </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>  </footer>
</main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11401860-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Extend Django User Model and Generic Class Based View "GCBV"",
  "headline": "Extend Django User Model and Generic Class Based View "GCBV"",
  "datePublished": "2015-12-18 12:00:00+03:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Emad Mokhtar",
    "url": "http://www.emadmokhtar.com/author/emad-mokhtar.html"
  },
  "image": "http://www.emadmokhtar.com/images/profile.jpg",
  "url": "http://www.emadmokhtar.com/extend-django-user-model-and-generic-class-based-view-gcbv.html",
  "description": "When I started to learn Django, I used to use the function based view aka FBV and in my current project I decided to learn class based view CBV, I watched one DjangoCon videos by Andrew Pinkham to make this easier on me, and if you tried or planning to learn CBV, you will be confused about the class based views and the generic class based views inside Django, it’s some many of them, please watch the video to get your head around it. OK, now I’ve done my homework and it’s time to use CBV, believe me it’s easy and you will find the number of code lines inside our views will be decreased specially if you use GCBV. User Model and GCBV What is the relation between GCBV and User Model? Great question, while I’m working with one of my models fro example her the Teacher model, and teacher will has a user credentials in order to user the app. The easiest and the straightforward way is to make one-to-one relation with django.contrib.auth.models.User please read the quote from Django documentation: There are two ways to extend the default User …"
}
</script></body>
</html>